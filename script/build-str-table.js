"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const strtable_1 = require("../lib/util/strtable");
const table_1 = require("../lib/zh/convert/table");
const min_1 = require("../lib/zh/convert/min");
const fs = require("fs-extra");
const path = require("path");
const table_plus_1 = require("../lib/zh/convert/table_plus");
let build_path = path.join(__dirname, '../build');
(async () => {
    await build('table_tw2cn', table_1.table_tw2cn, table_plus_1.table_tw2cn_plus);
    await new Promise(function (done) {
        setImmediate(done);
    });
    await build('table_cn2tw', table_1.table_cn2tw, table_plus_1.table_cn2tw_plus);
    await buildDebug('table_tw2cn', table_1.table_tw2cn, table_1.table_cn2tw, table_plus_1.table_tw2cn_plus, table_plus_1.table_tw2cn_min_plus);
    await buildDebug('table_cn2tw', table_1.table_cn2tw, table_1.table_tw2cn, table_plus_1.table_cn2tw_plus, table_plus_1.table_cn2tw_min_plus);
})();
async function buildDebug(name, table1, table2, table_plus, table_min_plus) {
    let out = Object.entries(table1)
        .sort(function (a, b) {
        return a[0].codePointAt(0) - b[0].codePointAt(0);
    })
        .reduce(function (a, b) {
        let [from, to] = b;
        if (min_1.SAFE_MODE_CHAR_MIN.includes(from) || from !== table2[to] || table2[from] || (to in table1 && (table1[to] != from))) {
            a.unsafe[from] = to;
        }
        else {
            a.safe[from] = to;
        }
        return a;
    }, {
        safe: {},
        unsafe: {},
    });
    if (table_plus) {
        Object.assign(out.safe, table_plus);
    }
    if (table_min_plus) {
        Object.assign(out.safe, table_min_plus);
    }
    let t1 = strtable_1.toStrTableArray(out.safe, {
        coreJs: true,
        ignore: true,
    });
    let t2 = strtable_1.toStrTableArray(out.safe);
    let path_out = path.join(build_path, 'zh/convert/');
    let ID = 'safe';
    return Promise.all([
        fs.outputFile(path.join(path_out, ID, `${name}.base.from.txt`), t1.from.join('')),
        fs.outputFile(path.join(path_out, ID, `${name}.base.to.txt`), t1.to.join('')),
        fs.outputFile(path.join(path_out, ID, `${name}.unicode.from.txt`), t2.from.join('')),
        fs.outputFile(path.join(path_out, ID, `${name}.unicode.to.txt`), t2.to.join('')),
        fs.outputJSON(path.join(path_out, `${name}.debug.json`), out, {
            spaces: "\t",
        })
    ]);
}
function build(name, table, table_plus) {
    let table2 = Object.entries(table)
        .reduce(function (a, b) {
        let [from, to] = b;
        a[from] = to;
        return a;
    }, {});
    if (table_plus) {
        Object.assign(table2, table_plus);
    }
    let t1 = strtable_1.toStrTableArray(table2, {
        coreJs: true,
        ignore: true,
    });
    let t2 = strtable_1.toStrTableArray(table2);
    console.log(`build: ${name}
table1 : ${Object.keys(table).length}
table2 : ${Object.keys(table2).length}
base   : ${t1.from.length}
unicode: ${t2.from.length}`);
    let path_out = path.join(build_path, 'zh/convert/');
    let ID = 'unsafe';
    return Promise.all([
        fs.outputJSON(path.join(path_out, `${name}.json`), table2, {
            spaces: "\t",
        }),
        fs.outputFile(path.join(path_out, ID, `${name}.base.from.txt`), t1.from.join('')),
        fs.outputFile(path.join(path_out, ID, `${name}.base.to.txt`), t1.to.join('')),
        fs.outputFile(path.join(path_out, ID, `${name}.unicode.from.txt`), t2.from.join('')),
        fs.outputFile(path.join(path_out, ID, `${name}.unicode.to.txt`), t2.to.join('')),
    ]);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnVpbGQtc3RyLXRhYmxlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiYnVpbGQtc3RyLXRhYmxlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsbURBQW1FO0FBQ25FLG1EQUFtRTtBQUNuRSwrQ0FBMkQ7QUFDM0QsK0JBQWdDO0FBQ2hDLDZCQUE4QjtBQUM5Qiw2REFBOEg7QUFFOUgsSUFBSSxVQUFVLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsVUFBVSxDQUFDLENBQUM7QUFFbEQsQ0FBQyxLQUFLLElBQUksRUFBRTtJQUVYLE1BQU0sS0FBSyxDQUFDLGFBQWEsRUFBRSxtQkFBVyxFQUFFLDZCQUFnQixDQUFDLENBQUM7SUFFMUQsTUFBTSxJQUFJLE9BQU8sQ0FBQyxVQUFVLElBQUk7UUFFL0IsWUFBWSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3BCLENBQUMsQ0FBQyxDQUFDO0lBRUgsTUFBTSxLQUFLLENBQUMsYUFBYSxFQUFFLG1CQUFXLEVBQUUsNkJBQWdCLENBQUMsQ0FBQztJQUUxRCxNQUFNLFVBQVUsQ0FBQyxhQUFhLEVBQUUsbUJBQVcsRUFBRSxtQkFBVyxFQUFFLDZCQUFnQixFQUFFLGlDQUFvQixDQUFDLENBQUM7SUFDbEcsTUFBTSxVQUFVLENBQUMsYUFBYSxFQUFFLG1CQUFXLEVBQUUsbUJBQVcsRUFBRSw2QkFBZ0IsRUFBRSxpQ0FBb0IsQ0FBQyxDQUFDO0FBQ25HLENBQUMsQ0FBQyxFQUFFLENBQUM7QUFFTCxLQUFLLFVBQVUsVUFBVSxDQUFDLElBQVksRUFBRSxNQUV2QyxFQUFFLE1BRUYsRUFBRSxVQUVGLEVBQUUsY0FFRjtJQUVBLElBQUksR0FBRyxHQUFHLE1BQU0sQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDO1NBQzlCLElBQUksQ0FBQyxVQUFVLENBQUMsRUFBRSxDQUFDO1FBRW5CLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFBO0lBQ2pELENBQUMsQ0FBQztTQUNELE1BQU0sQ0FBQyxVQUFVLENBQUMsRUFBRSxDQUFDO1FBRXJCLElBQUksQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBRW5CLElBQUksd0JBQWtCLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLElBQUksS0FBSyxNQUFNLENBQUMsRUFBRSxDQUFDLElBQUksTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxJQUFJLE1BQU0sSUFBSSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsSUFBSSxJQUFJLENBQUMsQ0FBQyxFQUN0SDtZQUNDLENBQUMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDO1NBQ3BCO2FBRUQ7WUFDQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQztTQUNsQjtRQUVELE9BQU8sQ0FBQyxDQUFDO0lBQ1YsQ0FBQyxFQUFFO1FBQ0YsSUFBSSxFQUFFLEVBQUU7UUFDUixNQUFNLEVBQUUsRUFBRTtLQUNWLENBQUMsQ0FDRjtJQUVELElBQUksVUFBVSxFQUNkO1FBQ0MsTUFBTSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsSUFBSSxFQUFFLFVBQVUsQ0FBQyxDQUFDO0tBQ3BDO0lBRUQsSUFBSSxjQUFjLEVBQ2xCO1FBQ0MsTUFBTSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsSUFBSSxFQUFFLGNBQWMsQ0FBQyxDQUFDO0tBQ3hDO0lBRUQsSUFBSSxFQUFFLEdBQUcsMEJBQWUsQ0FBQyxHQUFHLENBQUMsSUFBSSxFQUFFO1FBQ2xDLE1BQU0sRUFBRSxJQUFJO1FBQ1osTUFBTSxFQUFFLElBQUk7S0FDWixDQUFDLENBQUM7SUFFSCxJQUFJLEVBQUUsR0FBRywwQkFBZSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUVuQyxJQUFJLFFBQVEsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUN2QixVQUFVLEVBQ1YsYUFBYSxDQUNiLENBQUM7SUFFRixJQUFJLEVBQUUsR0FBRyxNQUFNLENBQUM7SUFFaEIsT0FBTyxPQUFPLENBQUMsR0FBRyxDQUFDO1FBRWxCLEVBQUUsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsRUFBRSxFQUFFLEdBQUcsSUFBSSxnQkFBZ0IsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ2pGLEVBQUUsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsRUFBRSxFQUFFLEdBQUcsSUFBSSxjQUFjLENBQUMsRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUU3RSxFQUFFLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLEVBQUUsRUFBRSxHQUFHLElBQUksbUJBQW1CLENBQUMsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUNwRixFQUFFLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLEVBQUUsRUFBRSxHQUFHLElBQUksaUJBQWlCLENBQUMsRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUVoRixFQUFFLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLEdBQUcsSUFBSSxhQUFhLENBQUMsRUFBRSxHQUFHLEVBQUU7WUFDN0QsTUFBTSxFQUFFLElBQUk7U0FDWixDQUFDO0tBQ0YsQ0FBQyxDQUFDO0FBQ0osQ0FBQztBQUVELFNBQVMsS0FBSyxDQUFDLElBQVksRUFBRSxLQUU1QixFQUFFLFVBRUY7SUFFQSxJQUFJLE1BQU0sR0FBRyxNQUFNLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQztTQUNoQyxNQUFNLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQztRQUVyQixJQUFJLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUVuQixDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDO1FBRWIsT0FBTyxDQUFDLENBQUM7SUFDVixDQUFDLEVBQUUsRUFBRSxDQUFDLENBQ047SUFFRCxJQUFJLFVBQVUsRUFDZDtRQUNDLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxFQUFFLFVBQVUsQ0FBQyxDQUFDO0tBQ2xDO0lBRUQsSUFBSSxFQUFFLEdBQUcsMEJBQWUsQ0FBQyxNQUFNLEVBQUU7UUFDaEMsTUFBTSxFQUFFLElBQUk7UUFDWixNQUFNLEVBQUUsSUFBSTtLQUNaLENBQUMsQ0FBQztJQUVILElBQUksRUFBRSxHQUFHLDBCQUFlLENBQUMsTUFBTSxDQUFDLENBQUM7SUFFakMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxVQUFVLElBQUk7V0FDaEIsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxNQUFNO1dBQ3pCLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsTUFBTTtXQUMxQixFQUFFLENBQUMsSUFBSSxDQUFDLE1BQU07V0FDZCxFQUFFLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUM7SUFFNUIsSUFBSSxRQUFRLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FDdkIsVUFBVSxFQUNWLGFBQWEsQ0FDYixDQUFDO0lBRUYsSUFBSSxFQUFFLEdBQUcsUUFBUSxDQUFDO0lBRWxCLE9BQU8sT0FBTyxDQUFDLEdBQUcsQ0FBQztRQUNsQixFQUFFLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLEdBQUcsSUFBSSxPQUFPLENBQUMsRUFBRSxNQUFNLEVBQUU7WUFDMUQsTUFBTSxFQUFFLElBQUk7U0FDWixDQUFDO1FBQ0YsRUFBRSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxFQUFFLEVBQUUsR0FBRyxJQUFJLGdCQUFnQixDQUFDLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDakYsRUFBRSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxFQUFFLEVBQUUsR0FBRyxJQUFJLGNBQWMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQzdFLEVBQUUsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsRUFBRSxFQUFFLEdBQUcsSUFBSSxtQkFBbUIsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ3BGLEVBQUUsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsRUFBRSxFQUFFLEdBQUcsSUFBSSxpQkFBaUIsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0tBQ2hGLENBQUMsQ0FBQztBQUNKLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyB0b1N0clRhYmxlLCB0b1N0clRhYmxlQXJyYXkgfSBmcm9tICcuLi9saWIvdXRpbC9zdHJ0YWJsZSc7XG5pbXBvcnQgeyB0YWJsZV90dzJjbiwgdGFibGVfY24ydHcgfSBmcm9tICcuLi9saWIvemgvY29udmVydC90YWJsZSc7XG5pbXBvcnQgeyBTQUZFX01PREVfQ0hBUl9NSU4gfSBmcm9tICcuLi9saWIvemgvY29udmVydC9taW4nO1xuaW1wb3J0IGZzID0gcmVxdWlyZSgnZnMtZXh0cmEnKTtcbmltcG9ydCBwYXRoID0gcmVxdWlyZSgncGF0aCcpO1xuaW1wb3J0IHsgdGFibGVfY24ydHdfcGx1cywgdGFibGVfdHcyY25fcGx1cywgdGFibGVfY24ydHdfbWluX3BsdXMsIHRhYmxlX3R3MmNuX21pbl9wbHVzIH0gZnJvbSAnLi4vbGliL3poL2NvbnZlcnQvdGFibGVfcGx1cyc7XG5cbmxldCBidWlsZF9wYXRoID0gcGF0aC5qb2luKF9fZGlybmFtZSwgJy4uL2J1aWxkJyk7XG5cbihhc3luYyAoKSA9Plxue1xuXHRhd2FpdCBidWlsZCgndGFibGVfdHcyY24nLCB0YWJsZV90dzJjbiwgdGFibGVfdHcyY25fcGx1cyk7XG5cblx0YXdhaXQgbmV3IFByb21pc2UoZnVuY3Rpb24gKGRvbmUpXG5cdHtcblx0XHRzZXRJbW1lZGlhdGUoZG9uZSk7XG5cdH0pO1xuXG5cdGF3YWl0IGJ1aWxkKCd0YWJsZV9jbjJ0dycsIHRhYmxlX2NuMnR3LCB0YWJsZV9jbjJ0d19wbHVzKTtcblxuXHRhd2FpdCBidWlsZERlYnVnKCd0YWJsZV90dzJjbicsIHRhYmxlX3R3MmNuLCB0YWJsZV9jbjJ0dywgdGFibGVfdHcyY25fcGx1cywgdGFibGVfdHcyY25fbWluX3BsdXMpO1xuXHRhd2FpdCBidWlsZERlYnVnKCd0YWJsZV9jbjJ0dycsIHRhYmxlX2NuMnR3LCB0YWJsZV90dzJjbiwgdGFibGVfY24ydHdfcGx1cywgdGFibGVfY24ydHdfbWluX3BsdXMpO1xufSkoKTtcblxuYXN5bmMgZnVuY3Rpb24gYnVpbGREZWJ1ZyhuYW1lOiBzdHJpbmcsIHRhYmxlMToge1xuXHRbazogc3RyaW5nXTogc3RyaW5nLFxufSwgdGFibGUyOiB7XG5cdFtrOiBzdHJpbmddOiBzdHJpbmcsXG59LCB0YWJsZV9wbHVzPzoge1xuXHRbazogc3RyaW5nXTogc3RyaW5nLFxufSwgdGFibGVfbWluX3BsdXM/OiB7XG5cdFtrOiBzdHJpbmddOiBzdHJpbmcsXG59KVxue1xuXHRsZXQgb3V0ID0gT2JqZWN0LmVudHJpZXModGFibGUxKVxuXHRcdC5zb3J0KGZ1bmN0aW9uIChhLCBiKVxuXHRcdHtcblx0XHRcdHJldHVybiBhWzBdLmNvZGVQb2ludEF0KDApIC0gYlswXS5jb2RlUG9pbnRBdCgwKVxuXHRcdH0pXG5cdFx0LnJlZHVjZShmdW5jdGlvbiAoYSwgYilcblx0XHR7XG5cdFx0XHRsZXQgW2Zyb20sIHRvXSA9IGI7XG5cblx0XHRcdGlmIChTQUZFX01PREVfQ0hBUl9NSU4uaW5jbHVkZXMoZnJvbSkgfHwgZnJvbSAhPT0gdGFibGUyW3RvXSB8fCB0YWJsZTJbZnJvbV0gfHwgKHRvIGluIHRhYmxlMSAmJiAodGFibGUxW3RvXSAhPSBmcm9tKSkpXG5cdFx0XHR7XG5cdFx0XHRcdGEudW5zYWZlW2Zyb21dID0gdG87XG5cdFx0XHR9XG5cdFx0XHRlbHNlXG5cdFx0XHR7XG5cdFx0XHRcdGEuc2FmZVtmcm9tXSA9IHRvO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gYTtcblx0XHR9LCB7XG5cdFx0XHRzYWZlOiB7fSxcblx0XHRcdHVuc2FmZToge30sXG5cdFx0fSlcblx0O1xuXG5cdGlmICh0YWJsZV9wbHVzKVxuXHR7XG5cdFx0T2JqZWN0LmFzc2lnbihvdXQuc2FmZSwgdGFibGVfcGx1cyk7XG5cdH1cblxuXHRpZiAodGFibGVfbWluX3BsdXMpXG5cdHtcblx0XHRPYmplY3QuYXNzaWduKG91dC5zYWZlLCB0YWJsZV9taW5fcGx1cyk7XG5cdH1cblxuXHRsZXQgdDEgPSB0b1N0clRhYmxlQXJyYXkob3V0LnNhZmUsIHtcblx0XHRjb3JlSnM6IHRydWUsXG5cdFx0aWdub3JlOiB0cnVlLFxuXHR9KTtcblxuXHRsZXQgdDIgPSB0b1N0clRhYmxlQXJyYXkob3V0LnNhZmUpO1xuXG5cdGxldCBwYXRoX291dCA9IHBhdGguam9pbihcblx0XHRidWlsZF9wYXRoLFxuXHRcdCd6aC9jb252ZXJ0LycsXG5cdCk7XG5cblx0bGV0IElEID0gJ3NhZmUnO1xuXG5cdHJldHVybiBQcm9taXNlLmFsbChbXG5cblx0XHRmcy5vdXRwdXRGaWxlKHBhdGguam9pbihwYXRoX291dCwgSUQsIGAke25hbWV9LmJhc2UuZnJvbS50eHRgKSwgdDEuZnJvbS5qb2luKCcnKSksXG5cdFx0ZnMub3V0cHV0RmlsZShwYXRoLmpvaW4ocGF0aF9vdXQsIElELCBgJHtuYW1lfS5iYXNlLnRvLnR4dGApLCB0MS50by5qb2luKCcnKSksXG5cblx0XHRmcy5vdXRwdXRGaWxlKHBhdGguam9pbihwYXRoX291dCwgSUQsIGAke25hbWV9LnVuaWNvZGUuZnJvbS50eHRgKSwgdDIuZnJvbS5qb2luKCcnKSksXG5cdFx0ZnMub3V0cHV0RmlsZShwYXRoLmpvaW4ocGF0aF9vdXQsIElELCBgJHtuYW1lfS51bmljb2RlLnRvLnR4dGApLCB0Mi50by5qb2luKCcnKSksXG5cblx0XHRmcy5vdXRwdXRKU09OKHBhdGguam9pbihwYXRoX291dCwgYCR7bmFtZX0uZGVidWcuanNvbmApLCBvdXQsIHtcblx0XHRcdHNwYWNlczogXCJcXHRcIixcblx0XHR9KVxuXHRdKTtcbn1cblxuZnVuY3Rpb24gYnVpbGQobmFtZTogc3RyaW5nLCB0YWJsZToge1xuXHRbazogc3RyaW5nXTogc3RyaW5nLFxufSwgdGFibGVfcGx1cz86IHtcblx0W2s6IHN0cmluZ106IHN0cmluZyxcbn0pXG57XG5cdGxldCB0YWJsZTIgPSBPYmplY3QuZW50cmllcyh0YWJsZSlcblx0XHQucmVkdWNlKGZ1bmN0aW9uIChhLCBiKVxuXHRcdHtcblx0XHRcdGxldCBbZnJvbSwgdG9dID0gYjtcblxuXHRcdFx0YVtmcm9tXSA9IHRvO1xuXG5cdFx0XHRyZXR1cm4gYTtcblx0XHR9LCB7fSlcblx0O1xuXG5cdGlmICh0YWJsZV9wbHVzKVxuXHR7XG5cdFx0T2JqZWN0LmFzc2lnbih0YWJsZTIsIHRhYmxlX3BsdXMpO1xuXHR9XG5cblx0bGV0IHQxID0gdG9TdHJUYWJsZUFycmF5KHRhYmxlMiwge1xuXHRcdGNvcmVKczogdHJ1ZSxcblx0XHRpZ25vcmU6IHRydWUsXG5cdH0pO1xuXG5cdGxldCB0MiA9IHRvU3RyVGFibGVBcnJheSh0YWJsZTIpO1xuXG5cdGNvbnNvbGUubG9nKGBidWlsZDogJHtuYW1lfVxudGFibGUxIDogJHtPYmplY3Qua2V5cyh0YWJsZSkubGVuZ3RofVxudGFibGUyIDogJHtPYmplY3Qua2V5cyh0YWJsZTIpLmxlbmd0aH1cbmJhc2UgICA6ICR7dDEuZnJvbS5sZW5ndGh9XG51bmljb2RlOiAke3QyLmZyb20ubGVuZ3RofWApO1xuXG5cdGxldCBwYXRoX291dCA9IHBhdGguam9pbihcblx0XHRidWlsZF9wYXRoLFxuXHRcdCd6aC9jb252ZXJ0LycsXG5cdCk7XG5cblx0bGV0IElEID0gJ3Vuc2FmZSc7XG5cblx0cmV0dXJuIFByb21pc2UuYWxsKFtcblx0XHRmcy5vdXRwdXRKU09OKHBhdGguam9pbihwYXRoX291dCwgYCR7bmFtZX0uanNvbmApLCB0YWJsZTIsIHtcblx0XHRcdHNwYWNlczogXCJcXHRcIixcblx0XHR9KSxcblx0XHRmcy5vdXRwdXRGaWxlKHBhdGguam9pbihwYXRoX291dCwgSUQsIGAke25hbWV9LmJhc2UuZnJvbS50eHRgKSwgdDEuZnJvbS5qb2luKCcnKSksXG5cdFx0ZnMub3V0cHV0RmlsZShwYXRoLmpvaW4ocGF0aF9vdXQsIElELCBgJHtuYW1lfS5iYXNlLnRvLnR4dGApLCB0MS50by5qb2luKCcnKSksXG5cdFx0ZnMub3V0cHV0RmlsZShwYXRoLmpvaW4ocGF0aF9vdXQsIElELCBgJHtuYW1lfS51bmljb2RlLmZyb20udHh0YCksIHQyLmZyb20uam9pbignJykpLFxuXHRcdGZzLm91dHB1dEZpbGUocGF0aC5qb2luKHBhdGhfb3V0LCBJRCwgYCR7bmFtZX0udW5pY29kZS50by50eHRgKSwgdDIudG8uam9pbignJykpLFxuXHRdKTtcbn1cbiJdfQ==